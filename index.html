<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>WhiteJack</title>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #111;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        color: #ddd;
      }

      header {
        text-align: center;
        margin-bottom: 10px;
      }

      header h1 {
        font-weight: 500;
        color: #fff;
        margin: 0;
        font-size: 1.8rem;
        letter-spacing: 1px;
      }

      #game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .canvas-wrapper {
        border: 2px solid #333;
        background: black;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #canvas {
        display: block;
        border: none;
      }

      #toolbar {
        margin: 10px 0;
        display: flex;
        gap: 15px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
      }

      #toolbar input[type="checkbox"],
      #toolbar input[type="button"] {
        transform: scale(1.1);
        margin-right: 6px;
      }

      #status {
        margin-top: 10px;
        font-weight: 600;
        color: #aaa;
      }

      #progress {
        width: 250px;
        height: 12px;
        border-radius: 5px;
        overflow: hidden;
        background: #333;
      }

      progress::-webkit-progress-bar {
        background: #333;
      }

      progress::-webkit-progress-value {
        background-color: #5cc45b;
      }

      #output {
        width: 90%;
        max-width: 800px;
        height: 150px;
        margin-top: 20px;
        background: #000;
        color: #0f0;
        font-family: "Lucida Console", monospace;
        border: 1px solid #333;
        padding: 5px;
        display: none; /* hide console by default */
      }

      .spinner {
        border: 4px solid #333;
        border-top: 4px solid #5cc45b;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        animation: spin 0.8s linear infinite;
        margin-top: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>WhiteJack</h1>
    </header>

    <div id="game-container">
      <div id="toolbar">
        <label><input type="checkbox" id="resize" /> Resize Canvas</label>
        <label
          ><input type="checkbox" id="pointerLock" checked /> Lock Mouse</label
        >
        <input
          type="button"
          value="Fullscreen"
          onclick='Module.requestFullscreen(document.getElementById("pointerLock").checked, document.getElementById("resize").checked)'
        />
      </div>

      <div class="canvas-wrapper">
        <canvas
          class="emscripten"
          id="canvas"
          oncontextmenu="event.preventDefault()"
          tabindex="-1"
        ></canvas>
      </div>

      <div class="spinner" id="spinner"></div>
      <div id="status">Loading...</div>
      <progress hidden id="progress" max="100" value="0"></progress>

      <textarea id="output" rows="8"></textarea>
    </div>

    <script>
      var statusElement = document.getElementById("status"),
        progressElement = document.getElementById("progress"),
        spinnerElement = document.getElementById("spinner"),
        canvasElement = document.getElementById("canvas"),
        outputElement = document.getElementById("output");

      var Module = {
        print: (...args) => {
          console.log(...args);
          if (outputElement) {
            outputElement.value += args.join(" ") + "\n";
            outputElement.scrollTop = outputElement.scrollHeight;
          }
        },
        canvas: canvasElement,
        setStatus: (text) => {
          if (text) statusElement.textContent = text;
          var match = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
          if (match) {
            progressElement.hidden = false;
            progressElement.value = parseInt(match[2]);
            progressElement.max = parseInt(match[4]);
            spinnerElement.style.display = "inline-block";
          } else if (text === "All downloads complete.") {
            spinnerElement.style.display = "none";
            progressElement.hidden = true;
          }
        },
        totalDependencies: 0,
        monitorRunDependencies: (left) => {
          this.totalDependencies = Math.max(this.totalDependencies, left);
          Module.setStatus(
            left
              ? "Preparing... (" +
                  (this.totalDependencies - left) +
                  "/" +
                  this.totalDependencies +
                  ")"
              : "All downloads complete."
          );
        },
      };

      Module.setStatus("Downloading...");
      window.onerror = () => {
        Module.setStatus("Error - see console");
        spinnerElement.style.display = "none";
      };
    </script>

    <script async src="WhiteJack.js"></script>
  </body>
</html>
